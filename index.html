<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DQM1ãƒ»2 PSç‰ˆ é…åˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã€å®Œå…¨ç‰ˆã€‘</title>
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --text: #f8fafc; --accent: #38bdf8; --border: #334155; }
        body { font-family: 'Segoe UI', Meiryo, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; line-height: 1.6; }
        .wrapper { max-width: 1000px; margin: 0 auto; }
        header { text-align: center; margin-bottom: 20px; border-bottom: 2px solid var(--accent); padding-bottom: 10px; }
        .card { background: var(--card); padding: 20px; border-radius: 12px; border: 1px solid var(--border); margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; color: var(--accent); }
        select { width: 100%; padding: 12px; border-radius: 8px; background: #0f172a; color: white; border: 1px solid var(--border); font-size: 16px; margin-bottom: 15px; }
        button { width: 100%; padding: 15px; background: var(--accent); color: #0f172a; border: none; border-radius: 8px; font-size: 18px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        button:hover { background: #7dd3fc; }
        #output { background: #000; color: #10b981; padding: 20px; border-radius: 8px; font-family: 'Consolas', monospace; white-space: pre; overflow-x: auto; border: 1px solid var(--accent); line-height: 1.4; font-size: 13px; }
        .family-info { color: #f472b6; font-size: 0.9em; margin-top: 15px; border-top: 1px solid var(--border); padding-top: 10px; }
        .error { color: #f87171; font-weight: bold; }
    </style>
</head>
<body>
    <div class="wrapper">
        <header><h1>ğŸ‘¾ DQM1ãƒ»2 PSç‰ˆ é…åˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</h1></header>
        <div class="card">
            <label>1. ç›®æ¨™ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã®ç³»çµ±</label>
            <select id="familySelect" onchange="updateTargetList()"><option value="">-- èª­ã¿è¾¼ã¿ä¸­ --</option></select>
            <label>2. ç›®æ¨™ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼</label>
            <select id="targetSelect" disabled onchange="updateStartList()"><option value="">-- ç³»çµ±ã‚’é¸ã‚“ã§ãã ã•ã„ --</option></select>
            <label>3. æ‰‹æŒã¡ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã‹ã‚‰é–‹å§‹ (é–¢é€£ç¨®ã®ã¿)</label>
            <select id="startSelect" disabled><option value="">-- æœ€åˆã‹ã‚‰è¨ˆç®— --</option></select>
            <button onclick="generateTree()">å®Œå…¨ãƒ«ãƒ¼ãƒˆè§£æå®Ÿè¡Œ</button>
        </div>
        <div id="resultCard" class="card" style="display:none;"><div id="output"></div></div>
    </div>

<script>
let monsterFamilies = {};
let fusionRecipes = {};

// GitHubä¸Šã®JSONã‚’èª­ã¿è¾¼ã‚€æƒ³å®šï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ãƒ†ã‚¹ãƒˆæ™‚ã¯ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åŒãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç½®ãï¼‰
async function loadData() {
    try {
        const resFam = await fetch('family_list.json');
        const resFus = await fetch('fusion_list.json');
        monsterFamilies = await resFam.json();
        fusionRecipes = await resFus.json();
        
        const fSel = document.getElementById('familySelect');
        fSel.innerHTML = '<option value="">-- ç³»çµ±ã‚’é¸æŠ --</option>';
        Object.keys(monsterFamilies).forEach(f => fSel.add(new Option(f, f)));
    } catch (e) {
        alert("JSONãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚GitHubã®ãƒ‘ã‚¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
    }
}

function updateTargetList() {
    const tSel = document.getElementById('targetSelect');
    const family = document.getElementById('familySelect').value;
    tSel.innerHTML = '<option value="">-- ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã‚’é¸æŠ --</option>';
    if (family) {
        monsterFamilies[family].forEach(m => tSel.add(new Option(m, m)));
        tSel.disabled = false;
    } else {
        tSel.disabled = true;
    }
    updateStartList();
}

function updateStartList() {
    const sSel = document.getElementById('startSelect');
    const target = document.getElementById('targetSelect').value;
    sSel.innerHTML = '<option value="">-- æœ€åˆã‹ã‚‰è¨ˆç®— --</option>';
    if (!target) { sSel.disabled = true; return; }

    const related = new Set();
    function collect(m) {
        const routes = fusionRecipes.recipes[m];
        if (!routes) return;
        routes.forEach(route => {
            route.forEach(p => {
                if (!related.has(p)) { related.add(p); collect(p); }
            });
        });
    }
    collect(target);
    Array.from(related).sort().forEach(m => sSel.add(new Option(m, m)));
    sSel.disabled = false;
}

function generateTree() {
    const target = document.getElementById('targetSelect').value;
    const start = document.getElementById('startSelect').value;
    const output = document.getElementById('output');
    document.getElementById('resultCard').style.display = 'block';

    if (!target) return;
    if (!fusionRecipes.recipes[target] && target !== start) {
        output.innerHTML = `<span class="error">ã€Œ${target}ã€ã®é…åˆãƒ«ãƒ¼ãƒˆãŒã‚ã‚Šã¾ã›ã‚“ã€‚\n(é‡ç”Ÿã§ã®æ•ç²ã€ã¾ãŸã¯ç³»çµ±é…åˆã®æœ«ç«¯ã§ã™)</span>`;
        return;
    }

    let summary = {};
    let activeFamilies = new Set();

    function build(name, depth = 0) {
        if (name === start && start !== "") return `<span style="color:#fb7185">â˜…æ‰€æŒ[${name}]</span>\n`;
        const routes = fusionRecipes.recipes[name];
        if (!routes) {
            summary[name] = (summary[name] || 0) + 1;
            // ç³»çµ±åã ã£ãŸå ´åˆã€å…¨æ•°ãƒªã‚¹ãƒˆè¡¨ç¤ºãƒ•ãƒ©ã‚°ã‚’ç«‹ã¦ã‚‹
            for(let f in monsterFamilies) if(f === name) activeFamilies.add(f);
            return `<span style="color:#94a3b8">${name}</span>\n`;
        }
        const [p1, p2] = routes[0]; // è¤‡æ•°ã‚ã‚‹å ´åˆã¯ç¬¬1å€™è£œã‚’è¡¨ç¤º
        const indent = "  ".repeat(depth);
        let res = `<span style="color:#38bdf8">${name}</span>${routes.length > 1 ? ' (åˆ¥ãƒ¬ã‚·ãƒ”ã‚ã‚Š)' : ''}\n`;
        res += `${indent}â”£ ${build(p1, depth + 1)}${indent}â”— ${build(p2, depth + 1)}`;
        return res;
    }

    let html = build(target);
    let famHTML = "";
    activeFamilies.forEach(f => {
        famHTML += `\n<div class="family-info"><b style="color:#f472b6">${f}ã®å…¨ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼:</b>\n${monsterFamilies[f].join(", ")}</div>`;
    });
    output.innerHTML = html + famHTML + `\n\n<b style="color:#fbbf24">ã€å¿…è¦ç´ æåˆè¨ˆã€‘</b>\n` + 
        Object.entries(summary).map(([m, c]) => `${m} Ã— ${c}`).join("\n");
}

loadData();
</script>
</body>
</html>
