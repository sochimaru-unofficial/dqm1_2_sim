<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DQM1・2 PS版 配合ナビゲーター</title>
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --text: #f8fafc; --accent: #38bdf8; --border: #334155; }
        body { font-family: 'Segoe UI', Meiryo, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; line-height: 1.6; }
        .wrapper { max-width: 1000px; margin: 0 auto; }
        header { text-align: center; margin-bottom: 30px; border-bottom: 2px solid var(--accent); padding-bottom: 10px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .card { background: var(--card); padding: 20px; border-radius: 12px; border: 1px solid var(--border); }
        label { display: block; margin-bottom: 10px; font-weight: bold; color: var(--accent); }
        select { width: 100%; padding: 12px; border-radius: 8px; background: #0f172a; color: white; border: 1px solid var(--border); font-size: 16px; margin-bottom: 15px; }
        button { width: 100%; padding: 15px; background: var(--accent); color: #0f172a; border: none; border-radius: 8px; font-size: 18px; font-weight: bold; cursor: pointer; }
        button:hover { opacity: 0.9; }
        #result-container { display: none; margin-top: 20px; }
        #output { background: #000; color: #10b981; padding: 20px; border-radius: 8px; font-family: 'Consolas', monospace; white-space: pre; overflow-x: auto; border: 1px solid var(--accent); }
        .material-count { color: #fbbf24; font-weight: bold; }
    </style>
</head>
<body>

<div class="wrapper">
    <header>
        <h1>DQM1・2 PS版 配合ナビ</h1>
        <p>3サイトのデータを統合した最短ルート検索</p>
    </header>

    <div class="grid">
        <div class="card">
            <label>① 目標モンスターを選択</label>
            <select id="target"></select>
        </div>
        <div class="card">
            <label>② 手持ちモンスターを選択 (任意)</label>
            <select id="start">
                <option value="">-- 最初から --</option>
            </select>
        </div>
    </div>
    
    <button onclick="search()">ルートを生成する</button>

    <div id="result-container" class="card">
        <h2 style="margin-top:0">配合ツリー & 必要素材</h2>
        <div id="output"></div>
    </div>
</div>

<script>
/**
 * 配合データベース
 * ここに3サイトのデータを追加していくことで完成します。
 * 循環参照を防ぐため、血統・相手の順序はサイトの記述に従っています。
 */
const data = {
    // ？？？？系
    "ダークドレアム": ["デスタムーア(最終形態)", "わたぼう"],
    "デスタムーア(最終形態)": ["デスタムーア(変身)", "ムドー"],
    "デスタムーア(変身)": ["デスタムーア", "さそりアーマー"],
    "デスタムーア": ["ミルドラース", "さそりアーマー"],
    "ミルドラース": ["エスターク", "ゴールデンスライム"],
    "エスターク": ["デスピサロ", "キングレオ"],
    "デスピサロ": ["デュラン", "しんりゅう"],
    "ゾーマ": ["りゅうおう", "シドー"],
    "シドー": ["ジャミラス", "ローズバトラー"],
    "バラモス": ["ハーゴン", "やまたのおろち"],
    "ハーゴン": ["ワイトキング", "メタルキング"],
    "りゅうおう": ["ドラゴン系", "まおうのつかい"],

    // 特殊配合
    "しんりゅう": ["スカイドラゴン", "やまたのおろち"],
    "やまたのおろち": ["アンドレアル", "グレイトドラゴン"],
    "グレイトドラゴン": ["ドラゴン系", "キングスライム"],
    "にじくじゃく": ["ひくいどり", "ホークブリザード"],
    "ゴールデンスライム": ["メタルキング", "メタルキング"],
    "メタルキング": ["ぶちキング", "メタルドラゴン"],
    "グランスライム": ["ゴールデンスライム", "ゴールデンスライム"],
    "ローズバトラー": ["植物系", "？？？？系"],
    "デュラン": ["ずしおうまる", "ゴールデンゴーレム"],
    "ゴールデンゴーレム": ["ひょうがまじん", "ようがんまじん"],
    "まおうのつかい": ["がいこつけんし", "がいこつけんし"],
    "ムドー": ["ブースカ", "オルゴ・デミーラ"]
};

// 初期設定
const targetSelect = document.getElementById('target');
const startSelect = document.getElementById('start');
const names = Array.from(new Set([...Object.keys(data), ...Object.values(data).flat()])).sort();

names.forEach(n => {
    targetSelect.add(new Option(n, n));
    startSelect.add(new Option(n, n));
});

function search() {
    const target = targetSelect.value;
    const start = startSelect.value;
    const container = document.getElementById('result-container');
    const output = document.getElementById('output');
    
    container.style.display = 'block';
    let summary = {};

    function buildTree(monster, depth = 0) {
        if (monster === start && start !== "") {
            return `<span style="color:#fb7185">★手持ち[${monster}]からスタート</span>\n`;
        }
        if (!data[monster]) {
            summary[monster] = (summary[monster] || 0) + 1;
            return `<span style="color:#94a3b8">${monster} (基本個体)</span>\n`;
        }

        const [p1, p2] = data[monster];
        let res = `<span style="color:#38bdf8">${monster}</span> を作る\n`;
        const indent = "  ".repeat(depth + 1);
        res += `${indent}┣ ${buildTree(p1, depth + 1)}`;
        res += `${indent}┗ ${buildTree(p2, depth + 1)}`;
        return res;
    }

    let treeHTML = buildTree(target);
    let summaryHTML = "\n<span class='material-count'>【最終的に確保が必要なモンスター】</span>\n";
    for (const [m, count] of Object.entries(summary)) {
        summaryHTML += `${m} × ${count}\n`;
    }

    output.innerHTML = treeHTML + summaryHTML;
}
</script>
</body>
</html>
